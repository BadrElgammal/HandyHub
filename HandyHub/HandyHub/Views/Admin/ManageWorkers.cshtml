@using HandyHub.Models.Entities
@model IEnumerable<Worker>

@{
    Layout = "_AdminLayout";
    ViewData["Title"] = "إدارة العمال";
}

@section Styles {
    <link href="~/css/Admin/ManageWorkers.css" rel="stylesheet" />
}
@* ===========================
   ✅ Alerts
   =========================== *@
@if (ViewBag.errorMessage != null)
{
    <div class="alert-custom alert-danger-custom">
        <div class="alert-icon">
            <i class="fas fa-exclamation-circle"></i>
        </div>
        <span>@ViewBag.errorMessage</span>
    </div>
}

@if (TempData["msg"] != null)
{
    <div class="alert-custom alert-success-custom">
        <div class="alert-icon">
            <i class="fas fa-check-circle"></i>
        </div>
        <span>@TempData["msg"]</span>
    </div>
}

@* ===========================
   ✅ Page Header Banner
   =========================== *@
<div class="page-header-banner">
    <i class="fas fa-hard-hat page-header-icon"></i>
    <div class="page-header-content">
        <div class="page-header-info">
            <h1>
                <i class="fas fa-hard-hat me-2"></i>
                إدارة العمال
            </h1>
            <p>عرض وإدارة جميع العمال المسجلين في النظام</p>
        </div>
        <a asp-action="CreateWorker" class="btn-add-new">
            <i class="fas fa-plus-circle"></i>
            إضافة عامل جديد
        </a>
    </div>
</div>

@* ===========================
   ✅ Stats Summary
   =========================== *@
<div class="stats-summary">
    <div class="summary-card total">
        <div class="summary-icon">
            <i class="fas fa-users"></i>
        </div>
        <div class="summary-info">
            <h3>@Model.Count()</h3>
            <p>إجمالي العمال</p>
        </div>
    </div>
    <div class="summary-card available">
        <div class="summary-icon">
            <i class="fas fa-user-check"></i>
        </div>
        <div class="summary-info">
            <h3>@Model.Count(w => w.IsAvailable)</h3>
            <p>متاحين للعمل</p>
        </div>
    </div>
    <div class="summary-card unavailable">
        <div class="summary-icon">
            <i class="fas fa-user-clock"></i>
        </div>
        <div class="summary-info">
            <h3>@Model.Count(w => !w.IsAvailable)</h3>
            <p>غير متاحين</p>
        </div>
    </div>
    <div class="summary-card new">
        <div class="summary-icon">
            <i class="fas fa-user-plus"></i>
        </div>
        <div class="summary-info">
            <h3>@Model.Count(w => w.CreatedAt >= DateTime.Now.AddDays(-30))</h3>
            <p>عمال جدد (30 يوم)</p>
        </div>
    </div>
</div>

@* ===========================
   ✅ Search & Filter Bar
   =========================== *@
<div class="filter-bar">
    <div class="search-input-wrapper">
        <i class="fas fa-search"></i>
        <input type="text" id="searchInput" placeholder="ابحث عن عامل بالاسم أو التخصص..." />
    </div>
    <div class="filter-buttons">
        <button class="filter-btn active" data-filter="all">الكل</button>
        <button class="filter-btn" data-filter="available">متاح</button>
        <button class="filter-btn" data-filter="unavailable">غير متاح</button>
    </div>
</div>

@* ===========================
   ✅ Desktop Table View
   =========================== *@
<div class="table-card">
    <div class="table-header">
        <h3>
            <i class="fas fa-list"></i>
            قائمة العمال
        </h3>
        <span class="badge">@Model.Count() عامل</span>
    </div>

    @if (!Model.Any())
    {
        <div class="empty-state">
            <div class="empty-icon">
                <i class="fas fa-hard-hat"></i>
            </div>
            <h4>لا يوجد عمال حالياً</h4>
            <p>ابدأ بإضافة أول عامل للنظام</p>
            <a asp-action="CreateWorker" class="btn-empty-action">
                <i class="fas fa-plus-circle"></i>
                إضافة عامل جديد
            </a>
        </div>
    }
    else
    {
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>العامل</th>
                        <th>التخصص</th>
                        <th>المدينة</th>
                        <th>الحالة</th>
                        <th class="text-center">إجراءات</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var worker in Model)
                    {
                        <tr data-available="@worker.IsAvailable.ToString().ToLower()">
                            <td>
                                <div class="user-cell">
                                    <div class="user-avatar">
                                        @(worker.User?.Name?.Substring(0, 1).ToUpper() ?? "W")
                                    </div>
                                    <div class="user-info">
                                        <span class="user-name">@worker.User?.Name</span>
                                        <span class="user-email">@worker.User?.Email</span>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <span class="category-badge">
                                    <i class="fas fa-briefcase"></i>
                                    @(worker.Category?.Name ?? "غير محدد")
                                </span>
                            </td>
                            <td>
                                <span class="city-badge">
                                    <i class="fas fa-map-marker-alt"></i>
                                    @(worker.User?.City ?? "غير محدد")
                                </span>
                            </td>
                            <td>
                                <span class="status-badge @(worker.IsAvailable ? "status-available" : "status-unavailable")">
                                    <i class="fas @(worker.IsAvailable ? "fa-check-circle" : "fa-times-circle")"></i>
                                    @(worker.IsAvailable ? "متاح" : "غير متاح")
                                </span>
                            </td>
                            <td>
                                <div class="action-btns">
                                    <form asp-action="SuspendWorker"
                                          method="post"
                                          style="display:inline-block;">
                                        <input type="hidden" name="id" value="@worker.Id" />
                                        <button type="submit"
                                                class="btn-action btn-action-toggle @(worker.IsAvailable ? "active" : "")"
                                                title="@(worker.IsAvailable ? "تعطيل" : "تفعيل")">
                                            <i class="fas fa-power-off"></i>
                                        </button>
                                    </form>
                                    <a asp-action="WorkerDetails"
                                       asp-route-id="@worker.Id"
                                       class="btn-action btn-action-view"
                                       title="تفاصيل">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <a asp-action="EditWorker"
                                       asp-route-id="@worker.Id"
                                       class="btn-action btn-action-edit"
                                       title="تعديل">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <form asp-action="DeleteWorker"
                                          method="post"
                                          onsubmit="return confirm('هل أنت متأكد من حذف هذا العامل؟');"
                                          style="display:inline-block;">
                                        <input type="hidden" name="id" value="@worker.Id" />
                                        <button type="submit"
                                                class="btn-action btn-action-delete"
                                                title="حذف">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
</div>

@* ===========================
   ✅ Mobile Cards View
   =========================== *@
<div class="mobile-cards">
    @if (!Model.Any())
    {
        <div class="empty-state" style="background: #fff; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.08);">
            <div class="empty-icon">
                <i class="fas fa-hard-hat"></i>
            </div>
            <h4>لا يوجد عمال حالياً</h4>
            <p>ابدأ بإضافة أول عامل للنظام</p>
            <a asp-action="CreateWorker" class="btn-empty-action">
                <i class="fas fa-plus-circle"></i>
                إضافة عامل جديد
            </a>
        </div>
    }
    else
    {
        @foreach (var worker in Model)
        {
            <div class="worker-card" data-available="@worker.IsAvailable.ToString().ToLower()">
                <div class="worker-card-header">
                    <div class="worker-card-avatar">
                        @(worker.User?.Name?.Substring(0, 1).ToUpper() ?? "W")
                    </div>
                    <div class="worker-card-info">
                        <h4>@worker.User?.Name</h4>
                        <span>@(worker.Category?.Name ?? "غير محدد")</span>
                    </div>
                    <span class="worker-card-status @(worker.IsAvailable ? "status-card-available" : "status-card-unavailable")">
                        @(worker.IsAvailable ? "متاح" : "غير متاح")
                    </span>
                </div>

                <div class="worker-card-body">
                    <div class="worker-card-details">
                        <div class="detail-item">
                            <i class="fas fa-envelope"></i>
                            <span>@worker.User?.Email</span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-briefcase"></i>
                            <span>@(worker.Category?.Name ?? "غير محدد")</span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>@(worker.User?.City ?? "غير محدد")</span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-calendar-alt"></i>
                            <span>انضم في @worker.CreatedAt.ToShortDateString()</span>
                        </div>
                    </div>

                    <div class="worker-card-actions">
                        <form asp-action="SuspendWorker" method="post">
                            <input type="hidden" name="id" value="@worker.Id" />
                            <button type="submit" class="btn btn-toggle @(worker.IsAvailable ? "active" : "") w-100">
                                <i class="fas fa-power-off"></i>
                                @(worker.IsAvailable ? "تعطيل" : "تفعيل")
                            </button>
                        </form>
                        <a asp-action="WorkerDetails"
                           asp-route-id="@worker.Id"
                           class="btn btn-view">
                            <i class="fas fa-eye"></i>
                            تفاصيل
                        </a>
                        <a asp-action="EditWorker"
                           asp-route-id="@worker.Id"
                           class="btn btn-edit">
                            <i class="fas fa-edit"></i>
                            تعديل
                        </a>
                        <form asp-action="DeleteWorker"
                              method="post"
                              onsubmit="return confirm('هل أنت متأكد من حذف هذا العامل؟');">
                            <input type="hidden" name="id" value="@worker.Id" />
                            <button type="submit" class="btn btn-delete w-100">
                                <i class="fas fa-trash-alt"></i>
                                حذف العامل
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        }
    }
</div>

@section Scripts {
    <script>
        // Search functionality
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();

            // For desktop table
            document.querySelectorAll('.table tbody tr').forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });

            // For mobile cards
            document.querySelectorAll('.worker-card').forEach(card => {
                const text = card.textContent.toLowerCase();
                card.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });

        // Filter functionality
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                // Update active button
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                const filter = this.dataset.filter;

                // Filter table rows
                document.querySelectorAll('.table tbody tr[data-available]').forEach(row => {
                    if (filter === 'all') {
                        row.style.display = '';
                    } else if (filter === 'available') {
                        row.style.display = row.dataset.available === 'true' ? '' : 'none';
                    } else {
                        row.style.display = row.dataset.available === 'false' ? '' : 'none';
                    }
                });

                // Filter mobile cards
                document.querySelectorAll('.worker-card[data-available]').forEach(card => {
                    if (filter === 'all') {
                        card.style.display = '';
                    } else if (filter === 'available') {
                        card.style.display = card.dataset.available === 'true' ? '' : 'none';
                    } else {
                        card.style.display = card.dataset.available === 'false' ? '' : 'none';
                    }
                });
            });
        });
    </script>
}