@using System.Security.Claims
@{
    bool isAuthenticated = User?.Identity?.IsAuthenticated ?? false;

    var userName = User?.FindFirst(ClaimTypes.Name)?.Value ?? "مستخدم";
    var userRole = User?.FindFirst(ClaimTypes.Role)?.Value ?? "";
    var profileImage = User?.FindFirst("ProfileImage")?.Value ?? "/images/OIP.jpeg";
}

<header class="bg-white border-b border-gray-200 sticky top-0 z-50 shadow-md">
    <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">

            <!-- ✅ الشعار -->
            <a href="~/" class="flex items-center space-x-2 space-x-reverse">
                <div class="w-10 h-10 bg-gradient-to-br from-teal-600 to-blue-600 rounded-lg flex items-center justify-center">
                    <i class="ri-tools-fill text-white text-xl"></i>
                </div>
                <span class="text-2xl font-bold text-gray-900" style="font-family: 'Pacifico', serif;">HandyHub</span>
            </a>

            <!-- ✅ الروابط -->
            <div class="hidden md:flex items-center space-x-8 space-x-reverse">
                <a href="~/" class="text-gray-700 hover:text-teal-600 font-medium transition-colors">الرئيسية</a>
                @if (userRole == "Client")
                {
                    <a href="~/Client/Search" class="text-gray-700 hover:text-teal-600 font-medium transition-colors">ابحث عن عمّال</a>
                }
                else if(userRole == "Worker")
                {
                    <a href="~/Worker/Search" class="text-gray-700 hover:text-teal-600 font-medium transition-colors">ابحث عن عمّال</a>
                }
                <a href="~/Home/Index#how-it-works" class="text-gray-700 hover:text-teal-600 font-medium transition-colors">كيف يعمل</a>
                <a href="~/Home/Index#features" class="text-gray-700 hover:text-teal-600 font-medium transition-colors">المميزات</a>
            </div>

            <!-- ✅ قسم المستخدم -->
            <div class="flex items-center space-x-4 space-x-reverse">

                @if (!isAuthenticated)
                {
                    <!-- مستخدم غير مسجل -->
                    <a href="~/Auth/Login" class="px-4 py-2 text-teal-600 hover:text-teal-700 font-medium transition-colors">
                        تسجيل الدخول
                    </a>
                    <a href="~/Auth/Register" class="px-6 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 font-medium transition-colors">
                        إنشاء حساب
                    </a>
                }
                else
                {
                    <!-- مستخدم مسجل -->
                    <div class="relative group">
                        <button class="flex items-center space-x-2 space-x-reverse focus:outline-none">
                            <img src="@profileImage" alt="@userName" class="w-10 h-10 rounded-full border-2 border-teal-500 object-cover">
                            <span class="font-medium text-gray-800">@userName</span>
                            <i class="ri-arrow-down-s-line text-gray-500"></i>
                        </button>

                        <!-- ✅ القائمة المنسدلة -->
                        <div class="absolute hidden group-hover:block bg-white shadow-lg rounded-lg mt-2 right-0 w-52 border border-gray-100 z-50 text-right">

                            @* 🎯 القوائم حسب الدور *@

                            @if (userRole == "Admin")
                            {
                                <a href="~/Admin" class="block px-4 py-2 hover:bg-gray-50 text-gray-700">
                                    <i class="ri-dashboard-line ml-1 text-teal-600"></i> لوحة التحكم
                                </a>
                                <a href="~/Admin/ManageClients" class="block px-4 py-2 hover:bg-gray-50 text-gray-700">
                                    <i class="ri-user-settings-line ml-1 text-teal-600"></i> إدارة المستخدمين
                                </a>
                            }
                            else if (userRole == "Client")
                            {
                                <a href="~/Client/Profile" class="block px-4 py-2 hover:bg-gray-50 text-gray-700">
                                    <i class="ri-user-line ml-1 text-teal-600"></i> الملف الشخصي
                                </a>
                            }
                            else if (userRole == "Worker")
                            {
                                <a href="~/Worker/Profile" class="block px-4 py-2 hover:bg-gray-50 text-gray-700">
                                    <i class="ri-user-line ml-1 text-teal-600"></i> الملف الشخصي
                                </a>
                            }

                            <hr class="my-1">
                            <a href="~/Auth/Logout" class="block px-4 py-2 text-red-500 font-semibold hover:bg-gray-50">
                                <i class="ri-logout-box-line ml-1"></i> تسجيل الخروج
                            </a>
                        </div>
                    </div>
                }
            </div>

        </div>
    </nav>
</header>