@using System.Security.Claims
@using HandyHub.Data
@inject HandyHubDbContext _context;
@{
    var userEmail = User?.FindFirst(ClaimTypes.Email)?.Value ?? "email@example.com";
    var userRole = User?.FindFirst(ClaimTypes.Role)?.Value ?? "Admin";
    var userName = User?.FindFirst(ClaimTypes.Name)?.Value ?? "Administrator";
    var userId = int.Parse(User.FindFirst("UserId").Value);
    var userImage = _context.Users.FirstOrDefault(u => u.Id == userId)?.ImageUrl ?? "default-avatar-admin.png";
}

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
    <title>@ViewData["Title"] - HandyHub Admin</title>
    <link href="~/images/logo.png" rel="icon" type="image/png" />
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Bootstrap RTL -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet" />
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <link href="~/css/Admin/AdminLayout.css" rel="stylesheet" />
    @RenderSection("Styles", required: false)
</head>

<body>
    <partial name="_NotificationPartial" />
    <!-- ✅ زرار القائمة للموبايل -->
    <button class="mobile-menu-btn" onclick="toggleSidebar()" aria-label="فتح القائمة">
        <i class="fa-solid fa-bars" id="menuIcon"></i>
    </button>

    <!-- ✅ Overlay للموبايل -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

    <div class="admin-container">
        <!-- ✅ الشريط الجانبي -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-inner">
                <!-- Logo -->
                <div class="sidebar-logo">
                    <div class="logo-container">
                        <div class="logo-icon">
                            <i class="fas fa-tools"></i>
                        </div>
                        <span class="logo-text">HandyHub</span>
                    </div>
                </div>

                <!-- Profile Section -->
                <div class="sidebar-header">
                    <div class="profile-image-container">
                        <img src="~/ProfileImages/@userImage" alt="Profile" />
                        <span class="online-status"></span>
                    </div>
                    <h5>@userName</h5>
                    <small>@userEmail</small>
                    <span class="role-badge">
                        <i class="fas fa-shield-alt"></i>
                        @userRole
                    </span>
                </div>

                <!-- ✅ Navigation Links -->
                <div class="nav-links">
                    <div class="nav-section-title">القائمة الرئيسية</div>

                    <a asp-controller="Admin" asp-action="Dashboard"
                       class="@(ViewContext.RouteData.Values["action"]!.ToString() == "Dashboard" ? "active" : "")">
                        <i class="fa-solid fa-gauge-high"></i>
                        <span>لوحة التحكم</span>
                    </a>

                    <div class="nav-section-title">إدارة المستخدمين</div>

                    <a asp-controller="Admin" asp-action="ManageClients"
                       class="@(ViewContext.RouteData.Values["action"]!.ToString() == "ManageClients" ? "active" : "")">
                        <i class="fa-solid fa-users"></i>
                        <span>العملاء</span>
                    </a>

                    <a asp-controller="Admin" asp-action="ManageWorkers"
                       class="@(ViewContext.RouteData.Values["action"]!.ToString() == "ManageWorkers" ? "active" : "")">
                        <i class="fa-solid fa-person-digging"></i>
                        <span>العمال</span>
                    </a>

                    <div class="nav-section-title">إدارة المحتوى</div>

                    <a asp-controller="Admin" asp-action="ManageCategories"
                       class="@(ViewContext.RouteData.Values["action"]!.ToString() == "ManageCategories" ? "active" : "")">
                        <i class="fa-solid fa-tags"></i>
                        <span>الفئات</span>
                    </a>

                    <a asp-controller="Admin" asp-action="ManageReviews"
                       class="@(ViewContext.RouteData.Values["action"]!.ToString() == "ManageReviews" ? "active" : "")">
                        <i class="fa-solid fa-star"></i>
                        <span>التقييمات</span>
                    </a>

                    <div class="nav-section-title">التحليلات</div>

                    <a asp-controller="Admin" asp-action="Reports"
                       class="@(ViewContext.RouteData.Values["action"]!.ToString() == "Reports" ? "active" : "")">
                        <i class="fa-solid fa-chart-pie"></i>
                        <span>التقارير</span>
                    </a>
                </div>

                <!-- Sidebar Footer -->
                <div class="sidebar-footer">
                    <a class="logout-btn" href="@Url.Action("logout", "Admin")">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>تسجيل الخروج</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- ✅ منطقة المحتوى -->
        <div class="content">
            <!-- Top Header -->
            <div class="top-header">
                <div class="page-info">
                    <h1>@ViewData["Title"]</h1>
                    <div class="breadcrumb-nav">
                        <a href="@Url.Action("Dashboard", "Admin")">
                            <i class="fas fa-home"></i>
                        </a>
                        <i class="fas fa-chevron-left"></i>
                        <span>@ViewData["Title"]</span>
                    </div>
                </div>
                <div class="header-actions">
                    <!-- 🔔 Notifications Button -->
                    <button class="header-btn" title="الإشعارات">
                        <i class="fas fa-bell"></i>
                        <span class="notification-dot"></span>
                    </button>

                    <!-- ⚙️ Settings Dropdown -->
                    <div class="settings-dropdown">
                        <button class="header-btn" title="الإعدادات">
                            <i class="fas fa-cog"></i>
                        </button>
                        <div class="settings-menu">
                            <a asp-action="EditAdmin">
                                <i class="fas fa-user-edit"></i>
                                <span>تعديل الملف الشخصي</span>
                            </a>
                            <div class="divider"></div>
                            <a href="@Url.Action("logout", "Admin")" class="danger-item">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>تسجيل الخروج</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="main-content">
                
                @RenderBody()
            </div>
        </div>
    </div>

    <!-- ✅ ملفات الـ JS -->
    <script src="~/lib/jquery/jquery.min.js"></script>
    <script src="~/lib/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- ✅ سكريبت التحكم في القائمة -->
    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            const menuIcon = document.getElementById('menuIcon');

            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');

            if (sidebar.classList.contains('active')) {
                menuIcon.classList.remove('fa-bars');
                menuIcon.classList.add('fa-times');
                document.body.style.overflow = 'hidden';
            } else {
                menuIcon.classList.remove('fa-times');
                menuIcon.classList.add('fa-bars');
                document.body.style.overflow = '';
            }
        }

        // إغلاق القائمة عند الضغط على أي رابط (للموبايل)
        document.querySelectorAll('.nav-links a').forEach(link => {
            link.addEventListener('click', () => {
                if (window.innerWidth <= 991) {
                    toggleSidebar();
                }
            });
        });

        // إغلاق القائمة بالضغط على Escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                const sidebar = document.getElementById('sidebar');
                if (sidebar.classList.contains('active')) {
                    toggleSidebar();
                }
            }
        });

        // ✅ تصليح الـ viewport على الموبايل
        function fixViewport() {
            const vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
        }

        window.addEventListener('resize', fixViewport);
        window.addEventListener('orientationchange', fixViewport);
        fixViewport();
    </script>

    @RenderSection("Scripts", required: false)
</body>
</html>